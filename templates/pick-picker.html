{{define "pick-picker"}}
    <div id="pick-picker-overlay" class="pick-picker-overlay">
        <div class="pick-picker-modal">
            <div class="pick-picker-header">
                <h2>Week {{.CurrentWeek}}{{if .IsAdminMode}} <span style="color: #ff6b6b;">(Admin Mode)</span>{{end}}</h2>
                <button class="close-picker">Ã—</button>
            </div>
            <form id="pick-form"
                  hx-post="/submit-picks"
                  hx-target="#pick-result"
                  hx-swap="innerHTML">
                <input type="hidden" name="week" value="{{.CurrentWeek}}">
                <input type="hidden" name="season" value="{{.CurrentSeason}}">
                {{if .IsAdminMode}}
                    <input type="hidden" name="adminMode" value="true">
                    <input type="hidden" name="targetUserID" value="{{.TargetUserID}}">
                {{end}}
                
                <div class="pick-picker-content">
                    {{if .Games}}
                        {{/* Check if this is a modern season (2025+) for daily grouping */}}
                        {{if ge .CurrentSeason 2025}}
                            {{/* MODERN: 2025+ Daily Picker with Day Sections */}}
                            {{template "modern-daily-picker" dict "Games" .Games "PickState" .PickState "CurrentSeason" .CurrentSeason "CanSubmitPicks" .CanSubmitPicks}}
                        {{else}}
                            {{/* LEGACY: 2023-2024 All Games in One List */}}
                            <div class="pick-picker-grid">
                                {{range .Games}}
                                    {{template "pick-game-row" dict "Game" . "PickState" $.PickState "CanSubmitPicks" $.CanSubmitPicks}}
                                {{end}}
                            </div>
                        {{end}}
                    {{else}}
                        <p>No games available for picking this week.</p>
                    {{end}}
                </div>
                
                <div class="pick-picker-footer">
                    <div id="pick-result"></div>
                    <button type="submit" class="submit-picks-btn">Submit Picks</button>
                    <button type="button" class="cancel-picks-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Apply fallback class for disabled labels with checked checkboxes
        // This ensures existing picks are highlighted on disabled games for all browsers
        document.addEventListener('DOMContentLoaded', function() {
            const disabledLabels = document.querySelectorAll('.pick-checkbox-label.disabled');
            
            disabledLabels.forEach(function(label) {
                const checkbox = label.querySelector('.pick-checkbox');
                if (checkbox && checkbox.checked) {
                    label.classList.add('has-checked-pick');
                }
            });
        });
        
        // Also monitor for dynamic changes (if checkboxes are programmatically updated)
        document.addEventListener('change', function(event) {
            if (event.target.classList.contains('pick-checkbox')) {
                const label = event.target.closest('.pick-checkbox-label');
                if (label && label.classList.contains('disabled')) {
                    if (event.target.checked) {
                        label.classList.add('has-checked-pick');
                    } else {
                        label.classList.remove('has-checked-pick');
                    }
                }
            }
        });
    </script>
{{end}}