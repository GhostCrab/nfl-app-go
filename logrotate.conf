# NFL App Log Rotation Configuration
# Place this file in /etc/logrotate.d/nfl-app

/opt/nfl-app/logs/*.log {
    # Rotate when log reaches 30MB
    size 30M

    # Keep maximum 10 rotated files (with 30MB each = ~300MB total)
    # Plus current log file keeps total under 1GB
    rotate 10

    # Compress old log files to save space
    compress

    # Don't compress the first rotated file (most recent backup)
    delaycompress

    # Don't error if log file is missing
    missingok

    # Don't rotate empty files
    notifempty

    # Create new log file with specific permissions
    create 640 nfl-app nfl-app

    # Run commands after rotation
    postrotate
        # Send SIGUSR1 to app to reopen log files (if app supports it)
        # or restart service to ensure new log file is used
        /bin/systemctl reload-or-restart nfl-app >/dev/null 2>&1 || true
    endscript

    # Copy and truncate original file instead of moving
    # This prevents issues with file handles
    copytruncate

    # Add date extension to rotated files
    dateext
    dateformat -%Y%m%d-%s
}